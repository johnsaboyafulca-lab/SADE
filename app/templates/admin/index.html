{% extends "base.html" %}

{% block title %}Administración - Sistema de Seguimiento{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Administración</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-cogs text-primary"></i>
                Panel de Administración
            </h2>
            <span class="badge bg-cards2 text-dark">
                <i class="fas fa-shield-alt"></i> Administrador
            </span>
        </div>

        <!-- Tarjetas de Estadísticas -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-white bg-cards0">
                    <div class="card-body text-center">
                        <h3>{{ stats.total_usuarios }}</h3>
                        <p class="mb-0">Usuarios Totales</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-cards text-white">
                    <div class="card-body text-center">
                        <h3>{{ stats.usuarios_activos }}</h3>
                        <p class="mb-0">Usuarios Activos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-cards2 text-white">
                    <div class="card-body text-center">
                        <h3>{{ stats.administradores }}</h3>
                        <p class="mb-0">Administradores</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-cards3 text-dark">
                    <div class="card-body text-center">
                        <h3>{{ config.semestre_actual }}</h3>
                        <p class="mb-0">Semestre Actual</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Módulos de Administración -->
        <div class="row">
            <!-- Configuración del Sistema -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-cards2 text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-sliders-h"></i>
                            Configuración
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            Configure los parámetros del sistema, umbrales de riesgo, pesos de factores y semestres.
                        </p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Umbrales de riesgo</li>
                            <li><i class="fas fa-check text-success"></i> Pesos de factores</li>
                            <li><i class="fas fa-check text-success"></i> Semestre actual</li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <a href="{{ url_for('admin.configuracion') }}" class="btn btn-primary w-100 bg-cards2">
                            <i class="fas fa-edit"></i> Gestionar Configuración
                        </a>
                    </div>
                </div>
            </div>

            <!-- Gestión de Usuarios -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-cards text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-users-cog"></i>
                            Gestión de Usuarios
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            Administre los usuarios del sistema, roles, permisos y estados de las cuentas.
                        </p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Crear/editar usuarios</li>
                            <li><i class="fas fa-check text-success"></i> Asignar roles</li>
                            <li><i class="fas fa-check text-success"></i> Activar/desactivar</li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <a href="{{ url_for('admin.usuarios') }}" class="btn btn-success w-100 bg-cards">
                            <i class="fas fa-user-shield"></i> Gestionar Usuarios
                        </a>
                    </div>
                </div>
            </div>

            <!-- Backup y Logs -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-cards2 text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-database"></i>
                            Sistema y Logs
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            Monitoreo del sistema, logs de actividad, backup y mantenimiento.
                        </p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Ver logs del sistema</li>
                            <li><i class="fas fa-check text-success"></i> Backup de datos</li>
                            <li><i class="fas fa-check text-success"></i> Monitoreo</li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <div class="row g-2">
                            <div class="col-6">
                                <a href="{{ url_for('admin.backup') }}" class="btn btn-info w-100 bg-cards2">
                                    <i class="fas fa-save"></i> Backup
                                </a>
                            </div>
                            <div class="col-6">
                                <a href="{{ url_for('admin.logs') }}" class="btn btn-outline-info w-100">
                                    <i class="fas fa-clipboard-list"></i> Logs
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuración Actual - ACTUALIZADO A 3 FACTORES -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle"></i>
                    Configuración Actual del Sistema - Evaluación Intrasemestral
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Umbrales de Riesgo:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Alerta Amarilla:</strong> > {{ "%.2f"|format(config.umbral_amarillo) }}</li>
                            <li><strong>Alerta Roja:</strong> > {{ "%.2f"|format(config.umbral_rojo) }}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Pesos de Factores (Semestre Actual):</h6>
                        <ul class="list-unstyled">
                            <li><strong>Rendimiento:</strong> {{ "%.0f"|format(config.peso_rendimiento * 100) }}%</li>
                            <li><strong>Asistencia:</strong> {{ "%.0f"|format(config.peso_asistencia * 100) }}%</li>
                            <li><strong>Distribución:</strong> {{ "%.0f"|format(config.peso_distribucion * 100) }}%</li>
                            <!-- ELIMINADOS: Progreso e Historial -->
                        </ul>
                        <div class="mt-2 p-2 bg-light rounded">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i>
                                Sistema optimizado para evaluación intrasemestral con 3 factores
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>Parámetros Académicos:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Nota Mínima Aprobatoria:</strong> {{ config.nota_minima_aprobatoria }}/20</li>
                            <li><strong>Asistencia Mínima:</strong> {{ config.porcentaje_asistencia_minimo }}%</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Semestre:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Semestre Actual:</strong> {{ config.semestre_actual }}</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Descripción de Factores -->
                <div class="row mt-4">
                    <div class="col-12">
                        <h6>Factores de Evaluación:</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border-primary">
                                    <div class="card-body">
                                        <h6 class="card-title text-primary">
                                            <i class="fas fa-chart-line"></i> Rendimiento
                                        </h6>
                                        <p class="card-text small mb-0">
                                            Evaluación de notas y promedios del semestre actual
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-success">
                                    <div class="card-body">
                                        <h6 class="card-title text-success">
                                            <i class="fas fa-calendar-check"></i> Asistencia
                                        </h6>
                                        <p class="card-text small mb-0">
                                            Porcentaje de asistencia en el semestre actual
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-info">
                                    <div class="card-body">
                                        <h6 class="card-title text-info">
                                            <i class="fas fa-project-diagram"></i> Distribución
                                        </h6>
                                        <p class="card-text small mb-0">
                                            Análisis de cuántos cursos están en riesgo
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}